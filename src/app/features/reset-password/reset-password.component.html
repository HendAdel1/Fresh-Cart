<div class="flex items-center justify-center p-4">
    <div class="w-full max-w-lg">
        <div class="mb-10">
            <div class="flex justify-between items-center mb-4 text-center">
                <div class="text-center">
                    <div class="bg-gray-300 w-10 h-10 mx-auto rounded-full flex items-center justify-center font-bold text-white"
                        [class.!bg-green-500]="step >= 1">
                        1
                    </div>
                    <p class="text-sm mt-2 text-gray-600">Enter Email</p>
                </div>
                <div class="text-center">
                    <div class="bg-gray-300 w-10 h-10 mx-auto rounded-full flex items-center justify-center font-bold text-white"
                        [class.!bg-green-500]="step >= 2">
                        2
                    </div>
                    <p class="text-sm mt-2 text-gray-600">Verify Code</p>
                </div>
                <div class="text-center">
                    <div class="bg-gray-300 w-10 h-10 mx-auto rounded-full flex items-center justify-center font-bold text-white"
                        [class.!bg-green-500]="step >= 3">
                        3
                    </div>
                    <p class="text-sm mt-2 text-gray-600">Reset Password</p>
                </div>
            </div>

            <div class="mb-7 flex gap-5">
                <div class="w-1/3 h-2 bg-gray-300 rounded" [class.!bg-green-500]="step >= 1"></div>
                <div class="w-1/3 h-2 bg-gray-300 rounded" [class.!bg-green-500]="step >= 2"></div>
                <div class="w-1/3 h-2 bg-gray-300 rounded" [class.!bg-green-500]="step >= 3"></div>
            </div>
        </div>

        <!-- Step 1: Forgot Password -->

        <div class="animate-slide-up hidden" [class.!block]="step === 1">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-key text-5xl text-main mb-4"></i>
                    <h2 class="text-3xl font-bold text-gray-800">Forgot Password</h2>
                    <p class="text-gray-600 mt-2">Enter your email to receive a verification code</p>
                </div>

                <form (ngSubmit)="handleForgotPassword()" [formGroup]="forgotPasswordGroup" class="space-y-6">
                    <div>
                        <label for="email" class="block mb-2 text-sm font-medium text-gray-700">Email</label>
                        <div class="relative">
                            <input formControlName="email" type="email" id="email" placeholder="name@company.com"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-main focus:border-main block w-full p-3.5 pl-11" />
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                <i class="fas fa-envelope text-gray-400"></i>
                            </div>
                        </div>
                        @if (forgotPasswordGroup.get('email')?.touched && forgotPasswordGroup.get('email')?.invalid) {
                        <div class="mt-2 text-sm text-red-600 flex items-center">
                            @if (forgotPasswordGroup.get('email')?.errors?.['required']) {
                            Email is required.
                            } @else if (forgotPasswordGroup.get('email')?.errors?.['email']) {
                            Please enter a valid email address.
                            }
                        </div>
                        }
                    </div>

                    @if (errorMessage) {
                    <div class="mb-4 p-3 rounded-lg bg-red-100 text-red-700 border border-red-300">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        {{ errorMessage }}
                    </div>
                    }

                    <button [disabled]="isLoading" type="submit"
                        class="disabled:bg-main/50 w-full py-3.5 px-4 text-sm font-medium rounded-lg text-white bg-main cursor-pointer hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-main transition duration-300 flex items-center justify-center">
                        @if (isLoading) {
                        Loading...
                        }@else {
                        Send Verification Code
                        }
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <a routerLink="/login" class="text-sm text-main cursor-pointer flex items-center justify-center">
                        <i class="fas fa-arrow-left mr-2"></i> Back to login
                    </a>
                </div>
            </div>
        </div>

        <!-- Step 2: Verify Code -->
        <div class="animate-slide-up hidden" [class.!block]="step === 2">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-shield-check text-5xl text-main mb-4"></i>
                    <h2 class="text-3xl font-bold text-gray-800">Verify Code</h2>
                    <p class="text-gray-600 mt-2">Enter the 6-digit code sent to your email</p>
                </div>

                <form (ngSubmit)="handleVerifyCode()" [formGroup]="verifyCodeGroup" class="space-y-6">
                    <div class="flex space-x-3 justify-center">
                        <input type="text" maxlength="1" formControlName="code1" (input)="updateResetCode()"
                            class="w-12 h-12 text-center text-xl font-bold border border-gray-300 rounded-lg focus:ring-main focus:border-main bg-gray-50" />
                        <input type="text" maxlength="1" formControlName="code2" (input)="updateResetCode()"
                            class="w-12 h-12 text-center text-xl font-bold border border-gray-300 rounded-lg focus:ring-main focus:border-main bg-gray-50" />
                        <input type="text" maxlength="1" formControlName="code3" (input)="updateResetCode()"
                            class="w-12 h-12 text-center text-xl font-bold border border-gray-300 rounded-lg focus:ring-main focus:border-main bg-gray-50" />
                        <input type="text" maxlength="1" formControlName="code4" (input)="updateResetCode()"
                            class="w-12 h-12 text-center text-xl font-bold border border-gray-300 rounded-lg focus:ring-main focus:border-main bg-gray-50" />
                        <input type="text" maxlength="1" formControlName="code5" (input)="updateResetCode()"
                            class="w-12 h-12 text-center text-xl font-bold border border-gray-300 rounded-lg focus:ring-main focus:border-main bg-gray-50" />
                        <input type="text" maxlength="1" formControlName="code6" (input)="updateResetCode()"
                            class="w-12 h-12 text-center text-xl font-bold border border-gray-300 rounded-lg focus:ring-main focus:border-main bg-gray-50" />



                    </div>

                    @if (verifyCodeGroup.get('resetCode')?.touched && verifyCodeGroup.get('resetCode')?.invalid) {
                    <div class="mt-2 text-sm text-red-600 flex items-center justify-center">
                        @if (verifyCodeGroup.get('resetCode')?.errors?.['required']) {
                        Code is required.
                        } @else if (verifyCodeGroup.get('resetCode')?.errors?.['minlength']) {
                        Code must be 6 digits.
                        }
                    </div>
                    }
                    <div class="text-center text-sm text-gray-600">
                        <p>
                            Didn't receive the code?
                            @if (resendAvailable) {
                            <a (click)="resendCode()"
                                class="text-main font-semibold cursor-pointer hover:underline">Resend</a>
                            } @else {
                            <span class="text-gray-400">Resend available in {{ countdown }}s</span>
                            }
                        </p>
                    </div>



                    <button [disabled]="isLoading" type="submit"
                        class="disabled:bg-main/50 w-full py-3.5 px-4 text-sm font-medium rounded-lg text-white bg-main cursor-pointer hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-main transition duration-300 flex items-center justify-center">
                        @if (isLoading) {
                        Loading...
                        }@else {
                        Verify Code
                        }
                    </button>
                </form>
            </div>
        </div>

        <!-- Step 3: Reset Password -->

        <div class="animate-slide-up hidden" [class.!block]="step === 3">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-lock text-5xl text-main mb-4"></i>
                    <h2 class="text-3xl font-bold text-gray-800">Reset Password</h2>
                    <p class="text-gray-600 mt-2">Create a new password for your account</p>
                </div>

                <form (ngSubmit)="handleResetPassword()" [formGroup]="resetPasswordGroup" class="space-y-6">

                    <!-- New Password -->
                    <div>
                        <label for="password" class="block mb-2 text-sm font-medium text-gray-700">New Password</label>
                        <div class="relative">
                            <input formControlName="newPassword" [type]="showPassword ? 'text' : 'password'"
                                id="password"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-main focus:border-main block w-full p-3.5 pr-11"
                                placeholder="Enter new password" />
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                <i class="fas text-gray-400 cursor-pointer" [class.fa-eye]="!showPassword"
                                    [class.fa-eye-slash]="showPassword"
                                    (click)="togglePasswordVisibility('password')"></i>

                            </div>
                        </div>

                        @if (resetPasswordGroup.get('newPassword')?.touched &&
                        resetPasswordGroup.get('newPassword')?.invalid) {
                        <div class="mt-2 text-sm text-red-600 flex items-center">
                            @if (resetPasswordGroup.get('newPassword')?.errors?.['required']) {
                            Password is required.
                            } @else if (resetPasswordGroup.get('newPassword')?.errors?.['pattern']) {
                            Password must start with a capital letter and be 6â€“11 characters long.
                            }
                        </div>
                        }
                    </div>

                    <!-- Confirm Password -->
                    <div>
                        <label for="confirm-password" class="block mb-2 text-sm font-medium text-gray-700">
                            Confirm Password
                        </label>
                        <div class="relative">
                            <input formControlName="confirmPassword" [type]="showConfirmPassword ? 'text' : 'password'"
                                id="confirm-password"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-main focus:border-main block w-full p-3.5 pr-11"
                                placeholder="Confirm password" />
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                <i class="fas text-gray-400 cursor-pointer" [class.fa-eye]="!showConfirmPassword"
                                    [class.fa-eye-slash]="showConfirmPassword"
                                    (click)="togglePasswordVisibility('confirm')"></i>
                            </div>
                        </div>

                        @if (resetPasswordGroup.get('confirmPassword')?.touched) {
                        @if (resetPasswordGroup.get('confirmPassword')?.errors?.['required']) {
                        <div class="mt-2 text-sm text-red-600 flex items-center">
                            Confirm Password is required.
                        </div>
                        } @else if (resetPasswordGroup.hasError('passwordMismatch')) {
                        <div class="mt-2 text-sm text-red-600 flex items-center">
                            Passwords do not match.
                        </div>
                        }
                        }

                    </div>

                    <button [disabled]="isLoading" type="submit"
                        class="disabled:bg-main/50 w-full py-3.5 px-4 text-sm font-medium rounded-lg text-white bg-main cursor-pointer hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-main transition duration-300 flex items-center justify-center">
                        @if (isLoading) {
                        Loading...
                        }@else {
                        Reset Password
                        }
                    </button>
                </form>
            </div>
        </div>

    </div>
</div>