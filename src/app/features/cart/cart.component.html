<section class="bg-white py-5 antialiased dark:bg-gray-900 ">
    <div class="flex justify-between mx-auto max-w-screen-xl px-4 2xl:px-0">
        @if (cartData?.data?.products?.length == 0) {
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white sm:text-2xl">Shopping Cart</h2>

        }
    </div>
</section>

<div class="container mx-auto p-6 mt-10">
    @if (isLoading) {
    <div class="flex justify-center items-center h-64">
        <div class="animate-spin rounded-full h-10 w-10 border-t-4 border-gray-400"></div>
    </div>
    } @else if (cartData && cartData.data.products.length > 0) {
    <div class="flex flex-col lg:flex-row gap-8">

        <!--  Cart Items -->
        <div class="flex-1 space-y-6">


            @for (item of cartData.data.products; track item._id; let i = $index) {
            <div
                class="flex flex-col md:flex-row items-center justify-between bg-white shadow-md rounded-xl p-4 border border-gray-200">

                <!-- Product Info -->
                <div class="flex items-center w-full md:w-2/3 gap-4">
                    <img [src]="item.product.imageCover" alt="{{ item.product.title }}"
                        class="w-24 h-24 object-contain rounded-lg" />

                    <div class="flex flex-col">
                        <h3 class="text-lg font-semibold text-gray-900">{{ item.product.title }}</h3>
                        <p class="text-gray-500 text-sm">{{ item.product.category.name }}</p>
                        <button (click)="deleteProduct(item.product._id)"
                            class="block text-red-600 font-medium text-sm hover:underline mt-2 cursor-pointer">
                            <i class="fa fa-solid fa-close"></i>
                            Remove
                        </button>
                    </div>
                </div>

                <!-- Quantity + Price -->
                <div class="flex items-center justify-between w-full md:w-1/3 mt-4 md:mt-0">

                    <!-- Quantity controls -->
                    <div class="flex items-center">
                        <!-- Minus Button -->
                        <button [disabled]="updateLoading && currentIndex == i" (click)="updateQuantity(item, -1 , i)"
                            class="w-6 h-6 flex items-center justify-center border border-main text-green-600 rounded hover:bg-green-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            @if (updateLoading && currentIndex == i) {
                            <i class="fa-solid fa-spinner fa-spin text-[10px]"></i>
                            } @else {
                            <i class="fa-solid fa-minus text-[10px]"></i>
                            }
                        </button>

                        <!-- Counter Input -->
                        <input type="text" class="w-8 h-8 text-center mx-2 border-0 text-sm font-medium text-gray-700"
                            [value]="item.count" readonly />

                        <!-- Plus Button -->
                        <button [disabled]="updateLoading && currentIndex == i" (click)="updateQuantity(item, 1 , i)"
                            class="w-6 h-6 flex items-center justify-center border border-main text-green-600 rounded hover:bg-green-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            @if (updateLoading && currentIndex == i) {
                            <i class="fa-solid fa-spinner fa-spin text-[10px]"></i>
                            } @else {
                            <i class="fa-solid fa-plus text-[10px]"></i>
                            }
                        </button>
                    </div>


                    <!-- Price -->
                    <div class="text-right">
                        <p class="text-lg font-semibold text-gray-900">
                            {{ item.price * item.count | currency:'EGP' }}
                        </p>
                        <p class="text-sm text-gray-500">each: {{ item.price | currency:'EGP' }}</p>
                    </div>
                </div>

            </div>
            }
            @if(cartData.numOfCartItems){
            <button (click)="clearCart()"
                class="bg-red-500 rounded text-white- px-4 py-2 cursor-pointer hover:bg-red-600">Clear</button>
            }
        </div>

        <!--  Summary -->
        <div class="w-full lg:w-1/3">
            <div class="bg-gray-50 shadow-md rounded-xl p-6 border border-gray-200">
                <h2 class="text-2xl font-bold mb-4">Order Summary</h2>

                <div class="flex justify-between mb-2 text-gray-700">
                    <span>Subtotal</span>
                    <span>{{ cartData.data.totalCartPrice | currency:'EGP' }}</span>
                </div>

                <div class="flex justify-between mb-2 text-gray-700">
                    <span>Shipping</span>
                    <span>Free</span>
                </div>

                <div class="flex justify-between text-lg font-semibold border-t border-gray-200 pt-3">
                    <span>Total</span>
                    <span>{{ cartData.data.totalCartPrice | currency:'EGP' }}</span>
                </div>

                <button (click)="isAddressFormOpen = true"
                    class="cursor-pointer w-full mt-6 bg-main hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-all duration-200">
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    } @else {
    <div class="flex flex-col items-center justify-center">
        <img src="images/empty-cart.png" alt="Empty cart" class="w-50 mb-6" />
        <h3 class="text-xl font-semibold text-gray-700 mb-2">Your cart is empty</h3>
        <p class="text-gray-500 mb-4">Looks like you haven't added any items yet.</p>
        <a routerLink="/products" class="bg-main text-white px-5 py-2 rounded-lg hover:bg-green-600 transition">
            Continue Shopping
        </a>
    </div>
    }
</div>



<!--  -->
<div [class.flex]="isAddressFormOpen" class="hidden fixed inset-0 bg-black/70  justify-center items-center">
    <form (ngSubmit)="checkoutSession()" class="max-w-3/4 w-96 bg-white p-4 rounded">
        <h2 class="text-2xl font-medium mb-2">Address Form</h2>
    <div class="mb-5">
        <label for="" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your details</label>
        <input formControlName="details" type="text" id="details" class="shadow-xs bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-main focus:border-main block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-main dark:focus:border-main dark:shadow-xs-light" placeholder="details"  />
    </div>

    <div class="mb-5">
        <label for="phone" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your phone</label>
        <input formControlName="phone" type="tel" id="phone" class="shadow-xs bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-main focus:border-main block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-main dark:focus:border-main dark:shadow-xs-light" placeholder="phone"  />
    </div>

    <div class="mb-5">
        <label for="city" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your city</label>
        <input formControlName="city" type="text" id="city" class="shadow-xs bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-main focus:border-main block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-main dark:focus:border-main dark:shadow-xs-light" placeholder="city"  />
    </div>

      <button type="submit" class="text-white bg-main hover:bg-green-600 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">Submit</button>

    </form>
</div>